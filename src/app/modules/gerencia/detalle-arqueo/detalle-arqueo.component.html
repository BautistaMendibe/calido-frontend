<div class="container py-3 col-xl-11">

  <!-- Título -->
  <br>
  <p class="titulo">Arqueo de Caja</p>
  <br>

  <!-- Información de apertura, estado y caja -->
  <div class="row row-equal-height">
    <div class="col-md-6">
      <mat-card class="mat-elevation-z12 p-4 mat-card-tamano-uniforme">
        <h4 style="color: grey">Información del Arqueo de Caja</h4>
        <mat-divider></mat-divider>
        <br>
        <p><strong>Caja:</strong> {{ arqueo.caja ? arqueo.caja.nombre : 'No disponible' }}</p>
        <p><strong>Fecha de apertura:</strong> {{ arqueo.fechaApertura | date: 'dd/MM/yyyy hh:ss' }}</p>
        <p><strong>Estado:</strong> {{ arqueo.estadoArqueo ? arqueo.estadoArqueo.nombre : 'No disponible' }}</p>
      </mat-card>
    </div>

    <!-- Ingresos/Egresos Manuales -->
    <div class="col-md-6">
      <mat-card class="mat-elevation-z12 p-4 mat-card-tamano-uniforme">
        <h4 style="color: grey">Añadir movimiento manual</h4>
        <mat-divider></mat-divider>
        <br>

        <!-- Form for adding manual movement -->
        <form [formGroup]="form">
          <div class="row">
            <!-- Tipo de movimiento -->
            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Tipo de movimiento</mat-label>
                <mat-select [formControl]="txTipoMovimiento">
                  <mat-option value="ingreso">Ingreso</mat-option>
                  <mat-option value="egreso">Egreso</mat-option>
                </mat-select>
              </mat-form-field>
              <app-error-messages [control]="txTipoMovimiento"></app-error-messages>
            </div>

            <!-- Forma de Pago -->
            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Forma de Pago</mat-label>
                <mat-select [formControl]="txFormaPago">
                  <mat-option *ngFor="let formaPago of formasPago" [value]="formaPago.id">
                    {{ formaPago.nombre }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <app-error-messages [control]="txFormaPago"></app-error-messages>
            </div>
          </div>

          <!-- Descripción -->
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Descripción</mat-label>
            <input matInput type="text" [formControl]="txDescripcion">
          </mat-form-field>
          <app-error-messages [control]="txDescripcion"></app-error-messages>

          <!-- Monto -->
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Monto</mat-label>
            <input matInput type="text" mask="separator.2" prefix="$" thousandSeparator="," [formControl]="txMonto">
          </mat-form-field>
          <app-error-messages [control]="txMonto"></app-error-messages>

          <button mat-raised-button color="accent" class="btn round" id="btnBuscar">Añadir movimiento</button>
        </form>
      </mat-card>
    </div>
  </div>

  <br><br>

  <!-- Filtro y Tabla de Ventas -->
  <div class="row mt-4">
    <div class="col-md-4">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Forma de Pago</mat-label>
        <button mat-icon-button matPrefix>
          <mat-icon>filter_list</mat-icon>
        </button>
        <mat-select>
          <mat-option *ngFor="let formaPago of formasPago" [value]="formaPago.id">
            {{ formaPago.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="col-md-12 mt-3">
      <mat-card class="mat-card" [hidden]="ventas.length === 0">
        <mat-card-content>
          <mat-table [dataSource]="tableDataSource" matSort class="custom-table">

            <ng-container matColumnDef="fecha">
              <mat-header-cell *matHeaderCellDef mat-sort-header>FECHA</mat-header-cell>
              <mat-cell *matCellDef="let venta">{{ venta.fecha | date: 'dd/MM/yyyy hh:mm:ss' }}</mat-cell>
            </ng-container>

            <ng-container matColumnDef="formaPago">
              <mat-header-cell *matHeaderCellDef>FORMA DE PAGO</mat-header-cell>
              <mat-cell *matCellDef="let venta">{{ venta.formaDePago.nombre }}</mat-cell>
            </ng-container>

            <ng-container matColumnDef="descripcion">
              <mat-header-cell *matHeaderCellDef>DESCRIPCION</mat-header-cell>
              <mat-cell *matCellDef="let venta">{{ (venta.anulada === true) ? 'Anulación de venta' : 'Venta' }} {{ venta.id }}</mat-cell>
            </ng-container>

            <ng-container matColumnDef="tipoMovimiento">
              <mat-header-cell *matHeaderCellDef>TIPO MOVIMIENTO</mat-header-cell>
              <mat-cell *matCellDef="let venta">{{ (venta.montoTotal > 0) ? 'Ingreso' : 'Egreso' }}</mat-cell>
            </ng-container>

            <ng-container matColumnDef="montoTotal">
              <mat-header-cell *matHeaderCellDef mat-sort-header>MONTO</mat-header-cell>
              <mat-cell *matCellDef="let venta">$ {{ venta.montoTotal | number:'1.2-2':'es-AR' }}</mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="columnas"></mat-header-row>
            <mat-row *matRowDef="let row; columns: columnas;"></mat-row>
          </mat-table>
        </mat-card-content>
        <mat-paginator
          [length]="this.ventas.length"
          [pageSize]="10"
          [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons>
        </mat-paginator>
      </mat-card>
    </div>
  </div>

  <br>

  <!-- Detalle de Ventas -->
  <div class="row mt-4 row-equal-height">
    <div class="col-md-6">
      <mat-card class="mat-elevation-z12 p-4 mat-card-tamano-uniforme">
        <h4>Detalle de Ventas</h4>
        <p><strong>Monto inicial:</strong> $ {{ arqueo.montoInicial | number:'1.2-2':'es-AR' }}</p>

        <h5>Ingresos</h5>
        <p>
          <strong>Efectivo:</strong> $1,500.00
          <button mat-icon-button (click)="toggleDetalle('efectivo')">
            <mat-icon>{{ detalleEfectivo ? 'expand_less' : 'expand_more' }}</mat-icon>
          </button>
        </p>
        <div *ngIf="detalleEfectivo">
          <p> - Ventas: $1,200.00</p>
          <p> - Movimiento Manual: $300.00</p>
        </div>

        <p>
          <strong>Tarjeta Crédito/Débito:</strong> $800.00
          <button mat-icon-button (click)="toggleDetalle('tarjeta')">
            <mat-icon>{{ detalleTarjeta ? 'expand_less' : 'expand_more' }}</mat-icon>
          </button>
        </p>
        <div *ngIf="detalleTarjeta">
          <p> - Ventas: $800.00</p>
        </div>

        <p>
          <strong>MercadoPago:</strong> $400.00
          <button mat-icon-button (click)="toggleDetalle('mercadopago')">
            <mat-icon>{{ detalleMercadoPago ? 'expand_less' : 'expand_more' }}</mat-icon>
          </button>
        </p>
        <div *ngIf="detalleMercadoPago">
          <p> - Ventas: $400.00</p>
        </div>

        <h5>Egresos</h5>
        <p>
          <strong>Efectivo:</strong> $200.00
          <button mat-icon-button (click)="toggleDetalle('egreso')">
            <mat-icon>{{ detalleEgreso ? 'expand_less' : 'expand_more' }}</mat-icon>
          </button>
        </p>
        <div *ngIf="detalleEgreso">
          <p> - Pago a proveedor: $200.00</p>
        </div>
      </mat-card>
    </div>

    <!-- Dinero en Caja -->
    <div class="col-md-6">
      <mat-card class="mat-elevation-z12 p-4 mat-card-tamano-uniforme">
        <h4>Dinero en Caja</h4>
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Cantidad de dinero en caja</mat-label>
          <input matInput type="text" mask="separator.2" prefix="$" thousandSeparator=",">
        </mat-form-field>
        <p><strong>Total registrado en sistema:</strong> $1,500.00</p>
        <p><strong>Diferencia:</strong> $-100.00</p>
      </mat-card>
    </div>
  </div>

  <!-- Botón Finalizar Arqueo -->
  <div class="row mt-4">
    <div class="col d-flex justify-content-end">
      <button mat-raised-button color="accent" class="btn round" id="btnBuscar2">Finalizar Arqueo</button>
    </div>
  </div>

</div> <!-- Cierre del contenedor -->
